{% schema %}
{
  "name": "Saloni Scroll Video",
  "settings": [
    { "type": "video", "id": "video_file", "label": "Video Dosyası (MP4)" },
    { "type": "text", "id": "eyebrow", "label": "Üst Küçük Başlık", "default": "COMPLIMENTARY DESIGN SERVICE" },
    { "type": "text", "id": "heading", "label": "Ana Başlık", "default": "BRING YOUR VISION TO LIFE" },
    { "type": "textarea", "id": "description", "label": "Açıklama", "default": "Unlock the potential of your home. Our professional 3D interior planning service is completely free of charge." },
    { "type": "text", "id": "btn_label", "label": "Buton Yazısı", "default": "START YOUR FREE PROJECT" },
    { "type": "url", "id": "btn_link", "label": "Buton Linki" },
    { "type": "range", "id": "min_scale", "label": "Başlangıç Ölçeği (%)", "min": 50, "max": 100, "step": 1, "default": 70 },
    { "type": "range", "id": "max_scale", "label": "Bitiş Ölçeği (%)", "min": 100, "max": 150, "step": 1, "default": 100 },
    { "type": "range", "id": "min_radius", "label": "Bitiş Köşe Yumuşaklığı (px)", "min": 0, "max": 100, "step": 1, "default": 0 },
    { "type": "range", "id": "max_radius", "label": "Başlangıç Köşe Yumuşaklığı (px)", "min": 0, "max": 100, "step": 1, "default": 40 },
    { "type": "range", "id": "scroll_length", "label": "Scroll Mesafesi (vh) - Pause için artırın", "min": 200, "max": 500, "step": 10, "default": 400 },
    { "type": "range", "id": "bottom_space", "label": "Alt Boşluk (px)", "min": 0, "max": 200, "step": 10, "default": 100 }
  ],
  "presets": [
    { "name": "Saloni Scroll Video" }
  ]
}
{% endschema %}

<section id="saloni-section-{{ section.id }}" class="saloni-scroll-wrapper" style="--scroll-height: {{ section.settings.scroll_length }}vh; margin-bottom: {{ section.settings.bottom_space }}px;">
  
  <div class="saloni-sticky-container">
    
    <div class="saloni-video-frame" id="video-frame-{{ section.id }}">
      
      {% if section.settings.video_file %}
        {{ section.settings.video_file | video_tag: autoplay: true, loop: true, muted: true, playsinline: true, class: 'saloni-video-element', id: 'video-el-' | append: section.id }}
      {% else %}
        <div class="saloni-video-placeholder" id="video-el-{{ section.id }}"></div>
      {% endif %}

      <div class="saloni-text-content" id="text-content-{{ section.id }}">
        {% if section.settings.eyebrow != blank %}
          <div class="saloni-eyebrow">{{ section.settings.eyebrow }}</div>
        {% endif %}
        
        {% if section.settings.heading != blank %}
<h2 class="saloni-heading" style="color: #ffffff !important;">{{ section.settings.heading }}</h2>        {% endif %}
        
        {% if section.settings.description != blank %}
          <div class="saloni-desc">{{ section.settings.description }}</div>
        {% endif %}
        
        {% if section.settings.btn_label != blank %}
          <a href="{{ section.settings.btn_link }}" class="saloni-btn">{{ section.settings.btn_label }}</a>
        {% endif %}
      </div>

    </div>
  </div>

</section>

<style>
  /* --- TEMEL YAPISAL CSS --- */
  .saloni-scroll-wrapper {
    position: relative;
    width: 100%;
    height: var(--scroll-height);
    background-color: #ffffff !important;
    /* Z-Index düşürüldü: Diğer sectionların ve Lightbox'ın önüne geçmemesi için 2 yapıldı */
    z-index: 2; 
    /* Taşma sorununu engellemek için */
    display: block;
  }

  .saloni-sticky-container {
    position: sticky;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: #ffffff !important;
  }

  .saloni-video-frame {
    position: relative;
    width: 100%;
    height: 100%;
    transform-origin: center center;
    overflow: hidden;
    background: #000;
  }

  .saloni-video-element, 
  .saloni-video-placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    transition: filter 0.5s ease; 
    filter: brightness(100%);
  }
  
  .saloni-video-placeholder {
    background-color: #ddd;
  }

  /* --- GÖRSEL İYİLEŞTİRMELER --- */

  .saloni-text-content {
    position: absolute;
    z-index: 20;
    left: 50%;
    top: 60%;
    transform: translate(-50%, 0);
    text-align: center;
    color: #ffffff;
    width: 90%;
    max-width: 800px;
    opacity: 0;
    transition: opacity 0.5s ease, transform 0.5s ease;
    pointer-events: none;
  }
  
  .saloni-text-content.is-visible {
    pointer-events: auto;
  }

  /* 1. KÜÇÜK BAŞLIK */
  .saloni-eyebrow {
    font-size: 14px;
    letter-spacing: 4px;
    text-transform: uppercase;
    font-weight: 700;
    margin-bottom: 15px;
    color: #ffffff !important; 
    text-shadow: 0 2px 10px rgba(0,0,0,0.9); 
  }
  
  /* 2. ANA BAŞLIK */
  .saloni-heading {
    font-size: 52px;
    line-height: 1.1;
    margin-bottom: 25px;
    font-weight: 600;
    color: #ffffff !important; 
    text-shadow: 0 4px 30px rgba(0,0,0,1); 
  }

  /* 3. AÇIKLAMA METNİ */
  .saloni-desc {
    font-size: 18px;
    line-height: 1.6;
    font-weight: 400;
    margin-bottom: 40px;
    color: #f2f2f2 !important; 
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    text-shadow: 0 2px 15px rgba(0,0,0,0.9);
  }

  /* 4. PREMIUM BUTON */
  .saloni-btn {
    display: inline-block;
    padding: 16px 48px;
    background: #ffffff !important;
    color: #000000 !important;
    text-decoration: none;
    border-radius: 50px;
    font-weight: 700;
    font-size: 15px;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
    border: 1px solid transparent;
  }
  
  /* HOVER EFEKTİ - MARKA RENGİ (#BCCF12) */
  .saloni-btn:hover {
    transform: scale(1.05);
    background: #BCCF12 !important; /* Marka Rengi */
    color: #000000 !important; /* Yazı rengi siyah */
    border-color: #BCCF12;
    box-shadow: 0 0 30px rgba(188, 207, 18, 0.6); 
  }

  @media (max-width: 768px) {
    .saloni-heading { font-size: 32px; }
    .saloni-desc { font-size: 15px; }
    .saloni-text-content { top: 55%; }
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const wrapper = document.getElementById("saloni-section-{{ section.id }}");
  const frame = document.getElementById("video-frame-{{ section.id }}");
  const videoEl = document.querySelector("#video-frame-{{ section.id }} .saloni-video-element") || document.querySelector("#video-frame-{{ section.id }} .saloni-video-placeholder");
  const textContent = document.getElementById("text-content-{{ section.id }}");

  const minScale = {{ section.settings.min_scale }} / 100;
  const maxScale = {{ section.settings.max_scale }} / 100;
  const maxRadius = {{ section.settings.max_radius }};
  const minRadius = {{ section.settings.min_radius }};

  function updateScroll() {
    const rect = wrapper.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    
    const distance = rect.height - viewportHeight;
    let progress = -rect.top / distance;

    if (progress < 0) progress = 0;
    if (progress > 1) progress = 1;

    // --- ANIMASYON MANTIĞI ---
    let growthProgress = progress / 0.30; 
    if (growthProgress > 1) growthProgress = 1; 

    const currentScale = minScale + (maxScale - minScale) * growthProgress;
    const currentRadius = maxRadius - (maxRadius - minRadius) * growthProgress;

    frame.style.transform = `scale(${currentScale})`;
    frame.style.borderRadius = `${currentRadius}px`;

    if (progress > 0.30 && progress < 0.75) {
      textContent.style.opacity = "1";
      textContent.style.transform = "translate(-50%, -50%)";
      textContent.classList.add("is-visible");
      
      if(videoEl) videoEl.style.filter = "brightness(40%)"; 

    } else {
      textContent.style.opacity = "0";
      textContent.style.transform = "translate(-50%, 0%)";
      textContent.classList.remove("is-visible");
      
      if(videoEl) videoEl.style.filter = "brightness(100%)";
    }
  }

  window.addEventListener("scroll", updateScroll);
  window.addEventListener("resize", updateScroll);
  
  updateScroll();
});
</script>